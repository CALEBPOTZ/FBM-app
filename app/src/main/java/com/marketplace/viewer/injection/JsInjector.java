package com.marketplace.viewer.injection;

import android.util.Log;
import android.webkit.ValueCallback;
import android.webkit.WebView;
import androidx.constraintlayout.widget.ConstraintLayout;
import kotlin.Metadata;
import kotlin.jvm.internal.Intrinsics;

/* compiled from: JsInjector.kt */
@Metadata(d1 = {"\u0000 \n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u000e\n\u0000\n\u0002\u0010\u0002\n\u0002\b\t\u0018\u0000 \u00102\u00020\u0001:\u0001\u0010B\r\u0012\u0006\u0010\u0002\u001a\u00020\u0003¢\u0006\u0002\u0010\u0004J\b\u0010\u0005\u001a\u00020\u0006H\u0002J\u0010\u0010\u0007\u001a\u00020\b2\u0006\u0010\t\u001a\u00020\u0006H\u0002J\u0006\u0010\n\u001a\u00020\bJ\u000e\u0010\u000b\u001a\u00020\b2\u0006\u0010\t\u001a\u00020\u0006J\b\u0010\f\u001a\u00020\bH\u0002J\u0006\u0010\r\u001a\u00020\bJ\b\u0010\u000e\u001a\u00020\bH\u0002J\b\u0010\u000f\u001a\u00020\bH\u0002R\u000e\u0010\u0002\u001a\u00020\u0003X\u0082\u0004¢\u0006\u0002\n\u0000¨\u0006\u0011"}, d2 = {"Lcom/marketplace/viewer/injection/JsInjector;", "", "webView", "Landroid/webkit/WebView;", "(Landroid/webkit/WebView;)V", "buildEnhancementScript", "", "executeJavaScript", "", "script", "injectAntiDetection", "injectCustomScript", "injectImageEnhancements", "injectMarketplaceEnhancements", "injectSavedListingsAccess", "injectSmoothImageSwipe", "Companion", "app_debug"}, k = 1, mv = {1, 9, 0}, xi = ConstraintLayout.LayoutParams.Table.LAYOUT_CONSTRAINT_VERTICAL_CHAINSTYLE)
/* loaded from: classes5.dex */
public final class JsInjector {
    private static final String TAG = "JsInjector";
    private final WebView webView;

    public JsInjector(WebView webView) {
        Intrinsics.checkNotNullParameter(webView, "webView");
        this.webView = webView;
    }

    public final void injectMarketplaceEnhancements() {
        Log.d(TAG, "Injecting marketplace enhancements");
        String script = buildEnhancementScript();
        executeJavaScript(script);
        injectSavedListingsAccess();
    }

    private final String buildEnhancementScript() {
        return "(function() {\n    console.log('Marketplace enhancements loading...');\n    \n    // Inject CSS to hide unwanted elements\n    var style = document.createElement('style');\n    style.id = 'marketplace-enhancements';\n    style.textContent = `\n        /* Hide main Facebook navigation header */\n        [role=\"banner\"] {\n            display: none !important;\n        }\n        \n        /* Hide left sidebar navigation */\n        [data-pagelet=\"LeftRail\"],\n        [aria-label=\"Navigation menu\"] {\n            display: none !important;\n        }\n        \n        /* Hide right sidebar (Stories, Sponsored, etc) */\n        [data-pagelet=\"RightRail\"] {\n            display: none !important;\n        }\n        \n        /* Hide footer */\n        [role=\"contentinfo\"] {\n            display: none !important;\n        }\n        \n        /* Hide notification/message popups that aren't marketplace-related */\n        [role=\"dialog\"]:not([aria-label*=\"Marketplace\"]) {\n            /* Keep marketplace dialogs, hide others */\n        }\n        \n        /* Expand main content area to full width */\n        [role=\"main\"] {\n            max-width: 100% !important;\n            margin: 0 !important;\n            padding: 8px !important;\n        }\n        \n        /* Hide \"Download App\" banners */\n        [data-testid*=\"app-banner\"],\n        [data-testid*=\"download-banner\"] {\n            display: none !important;\n        }\n        \n        /* Hide unnecessary Facebook features */\n        [aria-label*=\"Create post\"],\n        [aria-label*=\"Create a post\"],\n        [aria-label*=\"Stories\"] {\n            display: none !important;\n        }\n        \n        /* Style adjustments for cleaner look */\n        body {\n            background-color: #f0f2f5 !important;\n        }\n        \n        /* Keep search and filters visible */\n        [data-pagelet*=\"Marketplace\"],\n        [aria-label*=\"Search Marketplace\"],\n        [role=\"search\"] {\n            display: block !important;\n        }\n    `;\n    \n    // Check if style already exists\n    var existingStyle = document.getElementById('marketplace-enhancements');\n    if (existingStyle) {\n        existingStyle.remove();\n    }\n    \n    // Append to head\n    document.head.appendChild(style);\n    console.log('Marketplace enhancements applied');\n    \n    // Monitor DOM changes to reapply styles if Facebook loads new content\n    var observer = new MutationObserver(function(mutations) {\n        // Check if our style was removed\n        if (!document.getElementById('marketplace-enhancements')) {\n            console.log('Style removed, reapplying...');\n            document.head.appendChild(style.cloneNode(true));\n        }\n    });\n    \n    observer.observe(document.head, { childList: true });\n    \n})();";
    }

    public final void injectAntiDetection() {
        Log.d(TAG, "Injecting anti-detection script");
        executeJavaScript("(function() {\n    // Remove WebView indicators\n    delete window.ReactNativeWebView;\n    delete window.__REACT_DEVTOOLS_GLOBAL_HOOK__;\n    \n    // Mask some navigator properties\n    console.log('Anti-detection applied');\n})();");
    }

    private final void executeJavaScript(String script) {
        this.webView.evaluateJavascript(script, new ValueCallback() { // from class: com.marketplace.viewer.injection.JsInjector$$ExternalSyntheticLambda0
            @Override // android.webkit.ValueCallback
            public final void onReceiveValue(Object obj) {
                JsInjector.executeJavaScript$lambda$0((String) obj);
            }
        });
    }

    /* JADX INFO: Access modifiers changed from: private */
    public static final void executeJavaScript$lambda$0(String result) {
        Log.d(TAG, "Script execution result: " + result);
    }

    public final void injectCustomScript(String script) {
        Intrinsics.checkNotNullParameter(script, "script");
        Log.d(TAG, "Injecting custom script");
        executeJavaScript(script);
    }

    private final void injectSmoothImageSwipe() {
        Log.d(TAG, "Injecting smooth image swipe");
        executeJavaScript("(function() {\n    if (window._smoothSwipeAdded) return;\n    window._smoothSwipeAdded = true;\n    \n    var isDetailPage = window.location.href.includes('/marketplace/item/') || \n                       window.location.href.includes('/product/');\n    if (!isDetailPage) return;\n    \n    console.log('Adding smooth image swipe...');\n    \n    var startX = 0;\n    var currentX = 0;\n    var isDragging = false;\n    var dragTarget = null;\n    \n    document.addEventListener('touchstart', function(e) {\n        var img = e.target.closest('img');\n        if (img && img.width > 150 && img.src.includes('scontent')) {\n            startX = e.touches[0].clientX;\n            currentX = startX;\n            isDragging = true;\n            dragTarget = img;\n            dragTarget.style.transition = 'none';\n        }\n    }, {passive: true});\n    \n    document.addEventListener('touchmove', function(e) {\n        if (!isDragging || !dragTarget) return;\n        \n        currentX = e.touches[0].clientX;\n        var diff = currentX - startX;\n        \n        // Move the image with finger (limited range)\n        var maxMove = 100;\n        var move = Math.max(-maxMove, Math.min(maxMove, diff * 0.5));\n        dragTarget.style.transform = 'translateX(' + move + 'px)';\n    }, {passive: true});\n    \n    document.addEventListener('touchend', function(e) {\n        if (!isDragging || !dragTarget) return;\n        \n        var diff = currentX - startX;\n        \n        // Animate back to center\n        dragTarget.style.transition = 'transform 0.2s ease-out';\n        dragTarget.style.transform = 'translateX(0)';\n        \n        // If swiped far enough, trigger Facebook's native navigation\n        if (Math.abs(diff) > 80) {\n            // Find and click Facebook's arrow buttons\n            var arrows = document.querySelectorAll('[aria-label*=\"Next\"], [aria-label*=\"Previous\"], [aria-label*=\"next\"], [aria-label*=\"previous\"]');\n            arrows.forEach(function(arrow) {\n                var arrowLabel = arrow.getAttribute('aria-label') || '';\n                if (diff < 0 && arrowLabel.toLowerCase().includes('next')) {\n                    arrow.click();\n                } else if (diff > 0 && arrowLabel.toLowerCase().includes('previous')) {\n                    arrow.click();\n                }\n            });\n        }\n        \n        isDragging = false;\n        dragTarget = null;\n    }, {passive: true});\n    \n    console.log('Smooth image swipe ready');\n})();");
    }

    private final void injectImageEnhancements() {
        Log.d(TAG, "Injecting image enhancements");
        executeJavaScript("(function() {\n    console.log('Image enhancements v2 loading...');\n    \n    // Add CSS for image enhancements\n    var imageStyle = document.createElement('style');\n    imageStyle.id = 'marketplace-image-enhancements';\n    imageStyle.textContent = `\n        /* Make image containers swipeable */\n        [data-pagelet*=\"MarketplaceItem\"] img,\n        [role=\"img\"] {\n            cursor: pointer !important;\n            transition: transform 0.2s ease !important;\n        }\n        \n        /* Full-screen image viewer */\n        .marketplace-image-viewer {\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0, 0, 0, 0.95) !important;\n            z-index: 999999 !important;\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center !important;\n            flex-direction: column !important;\n        }\n        \n        .marketplace-image-viewer img {\n            max-width: 95vw !important;\n            max-height: 85vh !important;\n            object-fit: contain !important;\n            border-radius: 8px !important;\n        }\n        \n        .marketplace-image-viewer-controls {\n            position: absolute !important;\n            bottom: 20px !important;\n            display: flex !important;\n            gap: 10px !important;\n            color: white !important;\n            font-size: 14px !important;\n        }\n        \n        .marketplace-image-viewer-close {\n            position: absolute !important;\n            top: 20px !important;\n            right: 20px !important;\n            width: 40px !important;\n            height: 40px !important;\n            background: rgba(255, 255, 255, 0.2) !important;\n            border-radius: 50% !important;\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center !important;\n            cursor: pointer !important;\n            font-size: 24px !important;\n            color: white !important;\n        }\n        \n        .marketplace-nav-button {\n            position: absolute !important;\n            top: 50% !important;\n            transform: translateY(-50%) !important;\n            width: 50px !important;\n            height: 50px !important;\n            background: rgba(255, 255, 255, 0.3) !important;\n            border-radius: 50% !important;\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center !important;\n            cursor: pointer !important;\n            font-size: 24px !important;\n            color: white !important;\n            user-select: none !important;\n        }\n        \n        .marketplace-nav-button:active {\n            background: rgba(255, 255, 255, 0.5) !important;\n        }\n        \n        .marketplace-nav-left {\n            left: 20px !important;\n        }\n        \n        .marketplace-nav-right {\n            right: 20px !important;\n        }\n    `;\n    \n    if (!document.getElementById('marketplace-image-enhancements')) {\n        document.head.appendChild(imageStyle);\n    }\n    \n    // Track current listing images\n    var currentImages = [];\n    var currentImageIndex = 0;\n    var imageViewer = null;\n    var imageCache = {};\n    \n    // Function to find all images in the current listing detail page only\n    function findListingImages() {\n        var images = [];\n        \n        // Method 1: Find the first large image and its siblings\n        var allImages = document.querySelectorAll('img');\n        var largeImages = [];\n        \n        for (var i = 0; i < allImages.length; i++) {\n            var img = allImages[i];\n            // Skip small icons, emojis, profile pics\n            if (img.width < 100 || img.height < 100) continue;\n            if (img.src.includes('emoji')) continue;\n            if (img.src.includes('static.xx.fbcdn')) continue;\n            if (!img.src.includes('scontent')) continue;\n            \n            // Found a listing image\n            largeImages.push(img.src);\n            \n            // Find parent container and get all sibling images\n            var parent = img.closest('div[style*=\"display\"]');\n            if (parent && largeImages.length === 1) {\n                var siblingImgs = parent.querySelectorAll('img');\n                siblingImgs.forEach(function(sibImg) {\n                    if (sibImg.width >= 100 && sibImg.src.includes('scontent')) {\n                        largeImages.push(sibImg.src);\n                    }\n                });\n                break; // Found the gallery\n            }\n        }\n        \n        // Remove duplicates and clean URLs\n        images = [...new Set(largeImages)].map(function(src) {\n            // Remove size parameters to get full resolution\n            return src.split('?')[0];\n        }).slice(0, 15);\n        \n        console.log('Found ' + images.length + ' listing images');\n        return images;\n    }\n    \n    // Preload image with caching\n    function preloadImage(src) {\n        if (!imageCache[src]) {\n            imageCache[src] = new Image();\n            imageCache[src].src = src;\n        }\n        return imageCache[src];\n    }\n    \n    // Create full-screen image viewer\n    function showImageViewer(images, startIndex) {\n        currentImages = images;\n        currentImageIndex = startIndex;\n        \n        // Preload all images immediately\n        images.forEach(function(src) {\n            preloadImage(src);\n        });\n        \n        if (imageViewer) {\n            imageViewer.remove();\n        }\n        \n        imageViewer = document.createElement('div');\n        imageViewer.className = 'marketplace-image-viewer';\n        \n        var img = document.createElement('img');\n        img.src = images[startIndex];\n        img.style.transition = 'opacity 0.15s ease-in-out';\n        img.style.opacity = '1';\n        \n        var closeBtn = document.createElement('div');\n        closeBtn.className = 'marketplace-image-viewer-close';\n        closeBtn.textContent = '×';\n        closeBtn.onclick = function() {\n            imageViewer.remove();\n            imageViewer = null;\n        };\n        \n        var controls = document.createElement('div');\n        controls.className = 'marketplace-image-viewer-controls';\n        controls.textContent = (startIndex + 1) + ' / ' + images.length;\n        \n        imageViewer.appendChild(img);\n        imageViewer.appendChild(closeBtn);\n        imageViewer.appendChild(controls);\n        \n        // Add navigation buttons if multiple images\n        if (images.length > 1) {\n            var leftBtn = document.createElement('div');\n            leftBtn.className = 'marketplace-nav-button marketplace-nav-left';\n            leftBtn.textContent = '‹';\n            leftBtn.onclick = function(e) {\n                e.stopPropagation();\n                navigateImage(-1);\n            };\n            \n            var rightBtn = document.createElement('div');\n            rightBtn.className = 'marketplace-nav-button marketplace-nav-right';\n            rightBtn.textContent = '›';\n            rightBtn.onclick = function(e) {\n                e.stopPropagation();\n                navigateImage(1);\n            };\n            \n            imageViewer.appendChild(leftBtn);\n            imageViewer.appendChild(rightBtn);\n        }\n        \n        // Close on background click\n        imageViewer.onclick = function(e) {\n            if (e.target === imageViewer) {\n                imageViewer.remove();\n                imageViewer = null;\n            }\n        };\n        \n        // Touch gestures for swipe\n        var touchStartX = 0;\n        var touchEndX = 0;\n        \n        imageViewer.addEventListener('touchstart', function(e) {\n            touchStartX = e.changedTouches[0].screenX;\n        });\n        \n        imageViewer.addEventListener('touchend', function(e) {\n            touchEndX = e.changedTouches[0].screenX;\n            handleSwipe();\n        });\n        \n        function handleSwipe() {\n            var diff = touchStartX - touchEndX;\n            if (Math.abs(diff) > 50) { // Minimum swipe distance\n                if (diff > 0) {\n                    navigateImage(1); // Swipe left = next\n                } else {\n                    navigateImage(-1); // Swipe right = previous\n                }\n            }\n        }\n        \n        document.body.appendChild(imageViewer);\n    }\n    \n    function navigateImage(direction) {\n        currentImageIndex += direction;\n        if (currentImageIndex < 0) {\n            currentImageIndex = currentImages.length - 1;\n        } else if (currentImageIndex >= currentImages.length) {\n            currentImageIndex = 0;\n        }\n        \n        var img = imageViewer.querySelector('img');\n        var controls = imageViewer.querySelector('.marketplace-image-viewer-controls');\n        \n        // Instant transition (image is already preloaded)\n        img.style.opacity = '0';\n        \n        // Use cached/preloaded image for instant display\n        requestAnimationFrame(function() {\n            img.src = currentImages[currentImageIndex];\n            requestAnimationFrame(function() {\n                img.style.opacity = '1';\n            });\n            controls.textContent = (currentImageIndex + 1) + ' / ' + currentImages.length;\n        });\n    }\n    \n    // Add click handlers to images - only inside individual listing pages\n    document.addEventListener('click', function(e) {\n        var img = e.target.closest('img');\n        if (img && img.src && img.src.includes('scontent') && img.width >= 100) {\n            // Check if we're on an individual listing page\n            var url = window.location.href;\n            var isListingDetailPage = url.includes('/marketplace/item/') || \n                                      url.includes('/product/');\n            \n            // Only intercept clicks if we're on a detail page\n            if (isListingDetailPage) {\n                e.preventDefault();\n                e.stopPropagation();\n                \n                var images = findListingImages();\n                if (images.length > 0) {\n                    var clickedSrc = img.src.split('?')[0];\n                    var index = images.findIndex(function(src) {\n                        return src === clickedSrc || src.includes(clickedSrc);\n                    });\n                    if (index === -1) index = 0;\n                    showImageViewer(images, index);\n                }\n                return false;\n            }\n        }\n    }, true);\n    \n    console.log('Image enhancements applied');\n})();");
    }

    private final void injectSavedListingsAccess() {
        Log.d(TAG, "Injecting saved listings access");
        executeJavaScript("(function() {\n    console.log('Saved listings access loading...');\n    \n    // Add CSS for saved listings button\n    var savedStyle = document.createElement('style');\n    savedStyle.id = 'marketplace-saved-button';\n    savedStyle.textContent = `\n        .marketplace-saved-fab {\n            position: fixed !important;\n            top: 70px !important;\n            left: 10px !important;\n            width: 56px !important;\n            height: 56px !important;\n            border-radius: 50% !important;\n            background: #1877f2 !important;\n            color: white !important;\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center !important;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.3) !important;\n            cursor: pointer !important;\n            z-index: 9999 !important;\n            font-size: 24px !important;\n            transition: transform 0.2s ease !important;\n            user-select: none !important;\n        }\n        \n        .marketplace-saved-fab:active {\n            transform: scale(0.95) !important;\n        }\n        \n        .marketplace-saved-fab:hover {\n            box-shadow: 0 6px 12px rgba(0,0,0,0.4) !important;\n        }\n    `;\n    \n    if (!document.getElementById('marketplace-saved-button')) {\n        document.head.appendChild(savedStyle);\n    }\n    \n    // Create floating action button for saved listings\n    var savedButton = document.createElement('div');\n    savedButton.className = 'marketplace-saved-fab';\n    savedButton.innerHTML = '★';\n    savedButton.title = 'View Saved Listings';\n    savedButton.onclick = function() {\n        // Navigate to saved listings\n        window.location.href = 'https://www.facebook.com/marketplace/you/saved';\n    };\n    \n    // Add button after page loads\n    setTimeout(function() {\n        if (!document.querySelector('.marketplace-saved-fab')) {\n            document.body.appendChild(savedButton);\n        }\n    }, 2000);\n    \n    console.log('Saved listings access applied');\n})();");
    }
}
